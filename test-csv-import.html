<!DOCTYPE html>
<html>
<head>
  <title>Test CSV Import</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Test CSV Import Edge Function</h1>
  <button onclick="testImport()">Test Import</button>
  <pre id="output"></pre>

  <script>
    const SUPABASE_URL = 'https://rctyagxwbequikcdgkec.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_pxY8Sel2GnKwilum3ZWftA_Q3g1CuyE';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function testImport() {
      const output = document.getElementById('output');
      output.textContent = 'Testing...\n';

      try {
        // Test with sample CSV data
        const testData = {
          broker: 'manual',
          data: JSON.stringify([{
            security_name: 'Apple Inc',
            ticker: 'AAPL',
            quantity: 10,
            close_price: 185.50,
            value: 1855.00,
            cost_basis: 1500.00,
            asset_type: 'equity',
            institution_name: 'Test Import'
          }]),
          parseMode: 'holdings'
        };

        output.textContent += 'Request:\n' + JSON.stringify(testData, null, 2) + '\n\n';

        const { data, error } = await supabase.functions.invoke('import-csv-holdings', {
          body: testData,
          headers: {
            'privy-user-id': 'test-user-123'
          }
        });

        output.textContent += 'Response:\n';
        output.textContent += 'Data: ' + JSON.stringify(data, null, 2) + '\n';
        output.textContent += 'Error: ' + JSON.stringify(error, null, 2) + '\n';

      } catch (err) {
        output.textContent += 'Exception: ' + err.message + '\n';
        output.textContent += JSON.stringify(err, null, 2);
      }
    }
  </script>
</body>
</html>
